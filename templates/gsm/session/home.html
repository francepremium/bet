{% extends 'gsm/session/base.html' %}

{% load i18n gsm_tags comments %}

{% block extra_head %}
<style type="text/css">
table.session.header {
    width: 100%;
}
table.lineups {
    display: inline-block;
}

</style>
{% endblock %}

{% block body %}{{ block.super }}
    

    {% gsm_tree key='tables_tree' method='get_tables' type='season' id=session.season.competition.get_last_season.gsm_id %}
    {% gsm_render_tables_tree tables_tree %}

    {% if session.oponnent_A.gsm_id and session.oponnent_B.gsm_id %}
        {# avoid cases where we don't know the oponnent yet, ie. tournament #}
        {% gsm_tree key='h2h_tree' method='get_head_2_head_statistics' team_1_id=session.oponnent_A.gsm_id team_2_id=session.oponnent_B.gsm_id %}{# no available for basketball #}
    {% endif %}
    {% if h2h_tree %}
        <h2>{% trans 'previous matches' %}</h2>
        <table>
        {% for element in h2h_tree.getroot|findall:'head2head/match' %}
            {% gsm_entity key='team_A' tag='team' gsm_id=element.attrib.team_A_id name=element.attrib.team_A %}
            {% gsm_entity key='team_B' tag='team' gsm_id=element.attrib.team_B_id name=element.attrib.team_B %}
            {% gsm_entity key='match' tag='session' gsm_id=element.attrib.match_id name=element.attrib.team_B %}
            <tr>
                <td>
                    {{ element.attrib.date|display_date }}
                </td>
                <td class="{% if element.attrib.winner == 'team_A' %}winner{% endif %}">
                    <a href="{{ team_A.get_absolute_url }}" title="{{ team_A.name }}">{{ team_A.name }}</a>
                </td>
                <td>
                    <a href="{{ match.get_absolute_url }}">{{ element.attrib.fs_A|add:element.attrib.ets_A }}</a>
                </td>
                <td>
                    <a href="{{ match.get_absolute_url }}">-</a>
                </td>
                <td>
                    <a href="{{ match.get_absolute_url }}">{{ element.attrib.fs_B|add:element.attrib.ets_B }}</a>
                </td>
                <td class="{% if element.attrib.winner == 'team_B' %}winner{% endif %}">
                    <a href="{{ team_B.get_absolute_url }}" title="{{ team_B.name }}">{{ team_B.name }}</a>
                </td>
            </tr>
        {% endfor %}
        </table>

        <h2>{% trans 'head to head' %}</h2>
        <table>
        {% for element in h2h_tree.getroot|findall:'head2head/data' %}
            <tr>
                <th>{% trans element.attrib.type %}</th>
                <td>{{ element.attrib.matches }}</td>
                <td>{{ element.attrib.team_1_percent }}</td>
                <td>{{ element.attrib.team_2_percent }}</td>
                <td>{{ element.attrib.draw_percent }}</td>
            </tr>
        {% endfor %}
        </table>
    {% endif %}

    {% for child0 in session.element.getchildren %}
    {% if child0.tag == 'lineups' and child0.getchildren %}
    <h2>{% trans 'lineups' %}</h2>
    <table class="lineups A">
        {% for lineup in child0.getchildren %}
            {% if lineup.attrib.team_id == session.oponnent_A.gsm_id|addslashes %}
            <tr>
                <td class="L">
                    {% gsm_entity key='lineup_person' tag='person' gsm_id=lineup.attrib.person_id name=lineup.attrib.person %}
                    <a href="{{ lineup_person.get_absolute_url }}" title="{{ lineup_person.name }}">{{ lineup_person.name }}</a>
                </td>
            </tr>
            {% endif %}
        {% endfor %}
    </table>
    <table class="lineups B">
        {% for lineup in child0.getchildren %}
            {% if lineup.attrib.team_id == session.oponnent_B.gsm_id|addslashes %}
            <tr>
                <td class="L">
                    {% gsm_entity key='lineup_person' tag='person' gsm_id=lineup.attrib.person_id name=lineup.attrib.person %}
                    <a href="{{ lineup_person.get_absolute_url }}" title="{{ lineup_person.name }}">{{ lineup_person.name }}</a>
                </td>
            </tr>
            {% endif %}
        {% endfor %}
    </table>
    {% endif %}

    {% if child0.tag == 'substitutions' and child0.getchildren %}
    <h2>{% trans 'substitutions' %}</h2>
    <table class="substitutions">
        <tr>
            <th>{% trans 'in' %}</th>
            <th>{% trans 'out' %}</th>
            <th>{% trans 'minute' %}</th>
            <th>{% trans 'in' %}</th>
            <th>{% trans 'out' %}</th>
        </tr>
        {% for sub in child0.getchildren %}
            <tr>
            {% if sub.getchildren.0.attrib.team_id == session.oponnent_A.gsm_id|addslashes %}
                {% for event in sub.getchildren %}
                <td>
                    {% if event.attrib.code == 'SI' %}
                        {% gsm_entity key='person_in' tag='person' gsm_id=event.attrib.person_id name=event.attrib.person %}
                        <a href="{{ person_in.get_absolute_url }}" title="{{ person_in.name }}">{{ person_in.name }}</a>
                    {% endif %}
                    {% if event.attrib.code == 'SO' %}
                        {% gsm_entity key='person_out' tag='person' gsm_id=event.attrib.person_id name=event.attrib.person %}
                        <a href="{{ person_out.get_absolute_url }}" title="{{ person_out.name }}">{{ person_out.name }}</a>
                        </td>
                        <td>
                        {{ event.attrib.minute }}"
                    {% endif %}
                </td>
                {% endfor %}
                <td colspan="2"></td>
            {% else %}
                <td colspan="2"></td>
                {% for event in sub.getchildren %}
                <td>
                    {% if event.attrib.code == 'SI' %}
                        {{ event.attrib.minute }}"
                        </td>
                        <td>
                        {% gsm_entity key='person_in' tag='person' gsm_id=event.attrib.person_id name=event.attrib.person %}
                        <a href="{{ person_in.get_absolute_url }}" title="{{ person_in.name }}">{{ person_in.name }}</a>
                    {% endif %}
                    {% if event.attrib.code == 'SO' %}
                        {% gsm_entity key='person_out' tag='person' gsm_id=event.attrib.person_id name=event.attrib.person %}
                        <a href="{{ person_out.get_absolute_url }}" title="{{ person_out.name }}">{{ person_out.name }}</a>
                    {% endif %}
                </td>
                {% endfor %}
            {% endif %}
            </tr>
        {% endfor %}
    </table>
    {% endif %}

    {% if child0.tag == 'lineups_bench' and child0.getchildren %}
    <h2>{% trans 'lineups bench' %}</h2>
    <table class="lineups bench A">
        {% for lineup in child0.getchildren %}
            {% if lineup.attrib.team_id == session.oponnent_A.gsm_id|addslashes %}
            <tr>
                <td class="L">
                    {% gsm_entity key='lineup_person' tag='person' gsm_id=lineup.attrib.person_id name=lineup.attrib.person %}
                    <a href="{{ lineup_person.get_absolute_url }}" title="{{ lineup_person.name }}">{{ lineup_person.name }}</a>
                </td>
            </tr>
            {% endif %}
        {% endfor %}
    </table>
    <table class="lineups bench B">
        {% for lineup in child0.getchildren %}
            {% if lineup.attrib.team_id == session.oponnent_B.gsm_id|addslashes %}
            <tr>
                <td class="L">
                    {% gsm_entity key='lineup_person' tag='person' gsm_id=lineup.attrib.person_id name=lineup.attrib.person %}
                    <a href="{{ lineup_person.get_absolute_url }}" title="{{ lineup_person.name }}">{{ lineup_person.name }}</a>
                </td>
            </tr>
            {% endif %}
        {% endfor %}
    </table>
    {% endif %}

    {% if child0.tag == 'goals' and child0.getchildren %}
    <h2>{% trans 'goals' %}</h2>
    <table class="goals">
        {% for goal in child0.getchildren %}
        <tr>
            <td>
                {% if session|goal_column:goal == 'A' %}
                    {% gsm_entity key='goal_person' tag='person' gsm_id=goal.getchildren.0.attrib.person_id name=goal.getchildren.0.attrib.person %}

                    <span class="goal G"><a href="{{ goal_person.get_absolute_url }}" title="{{ goal_person.name }}">{{ goal_person.name }}</a></span>
                    {% if goal.getchildren.1.attrib.code == 'AS' %}
                        {% gsm_entity key='goal_assistant' tag='person' gsm_id=goal.getchildren.1.attrib.person_id name=goal.getchildren.1.attrib.person %}
                        <span class="goal AS">{% trans 'assisted by' %} <a href="{{ goal_assistant.get_absolute_url }}" title="{{ goal_assistant.name }}">{{ goal_assistant.name }}</a></span>
                    {% endif %}
                    {% if goal.getchildren.0.attrib.code == 'OG' %}
                        ({% trans 'OG' %})
                    {% endif %}
                {% endif %}

            </td>
            <td>
                <span class="minute">{{ goal.getchildren.0.attrib.minute }}"</span>
            </td>
            <td>
                {% if session|goal_column:goal == 'B' %}
                    {% gsm_entity key='goal_person' tag='person' gsm_id=goal.getchildren.0.attrib.person_id name=goal.getchildren.0.attrib.person %}

                    <span class="goal G"><a href="{{ goal_person.get_absolute_url }}" title="{{ goal_person.name }}">{{ goal_person.name }}</a></span>
                    {% if goal.getchildren.1.attrib.code == 'AS' %}
                        {% gsm_entity key='goal_assistant' tag='person' gsm_id=goal.getchildren.1.attrib.person_id name=goal.getchildren.1.attrib.person %}
                        <span class="goal AS">{% trans 'assisted by' %} <a href="{{ goal_assistant.get_absolute_url }}" title="{{ goal_assistant.name }}">{{ goal_assistant.name }}</a></span>
                    {% endif %}
                    {% if goal.getchildren.0.attrib.code == 'OG' %}
                        ({% trans 'OG' %})
                    {% endif %}
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </table>
    {% endif %}
    {% endfor %}

    {% if statistics.getchildren %}
    <h2>{% trans 'statistics' %}</h2>
    <table>
        <tr>
            <th></th>
            <th>{{ session.oponnent_A.name }}</th>
            <th>{{ session.oponnent_B.name }}</th>
        </tr>
        {% for data in statistics.getchildren %}
        <tr>
            <th>{% trans data.attrib.type %}</th>
            <td>{{ data.attrib.value_team_A }}</td>
            <td>{{ data.attrib.value_team_B }}</td>
        </tr>
        {% endfor %}
    </table>
    {% endif %}

    {% render_comment_form for session %}
    {% render_comment_list for session %}

{% endblock %}
