{% load gsm_tags i18n pagination_tags %}

{% if filter %}
<form action="" method="get">
    <table>
        {{ filter.form.as_table }}
    </table>
    <input type="submit" />
    <a href="{{ request.path }}">{% trans 'all' %}</a>
</form>
{% endif %}

{% if filter %}
    {% autopaginate bet_list 10 %}
    {% paginate %}
{% endif %}

<table>
    <thead>
        <tr>
            <th>{% trans 'nickname' %}</th>
            <th>{% trans 'date' %}</th>
            <th>{% trans 'time' %}</th>
            <th>{% trans 'sport' %}</th>
            <th>{% trans 'competition' %}</th>
            <th>{% trans 'area' %}</th>
            <th>{% trans 'match' %}</th>
            <th>{% trans 'bet' %}</th>
            <th>{% trans 'choice' %}</th>
            <th>{% trans 'odds' %}</th>
            <th>{% trans 'stake' %}</th>
            <th>{% trans 'bookmaker' %}</th>
            <th>{% trans 'support' %}</th>
            <th>{% trans 'result' %}</th>
            {% if request.user.is_authenticated %}
            <th>{% trans 'correct' %}</th>
            <th>{% trans 'flagged' %}</th>
            {% endif %}
        </tr>
    </thead>
    <tbody>
        {% for bet in bet_list %}
        <tr>
            <td>
                <a href="{{ bet.ticket.user.get_absolute_url }}" title="{{ bet.ticket.user }}">{{ bet.ticket.user }}</a>
            </td>
            <td>{{ bet.session.datetime_utc|display_date }}</td>
            <td>{{ bet.session.datetime_utc|display_time }}</td>
            <td>
                <a href="{{ bet.session.sport.get_absolute_url }}" title="{{ bet.session.sport }}">{{ bet.session.sport }}</a>
            </td>
            <td>
                <a href="{{ bet.session.season.competition.get_absolute_url }}" title="{{ bet.session.season.competition.name }}">{{ bet.session.season.competition.name }}</a>
            </td>
            <td>
                {{ bet.session.season.competition.area }}
            </td>
            <td>
                <a href="{{ bet.session.get_absolute_url }}" title="{{ bet.session }}">{{ bet.session }}</a>
            </td>
            <td>
                <a href="{% url session_bettype_detail bet.session.pk bet.bettype.pk %}">{{ bet.bettype }}</a>
            </td>
            <td>
                <a href="{{ bet.get_absolute_url }}" title="{{ bet.choice }}">{{ bet.choice }}</a>
            </td>
            <td>
                {{ bet.odds }}
            </td>
            <td>
                <a href="{{ bet.ticket.get_absolute_url }}" title="{{ bet.ticket }}">
                    {% if bet.ticket.bet_set.count == 1 %}
                        {{ bet.ticket.stake }}
                    {% else %}
                        {% trans 'combined ticket' %}
                    {% endif %}
                </a>
            </td>
            <td>
                <a href="{{ bet.ticket.bookmaker.get_absolute_url }}" title="{{ bet.ticket.bookmaker }}">{{ bet.ticket.bookmaker }}</a>
            </td>
            <td>
                {% if bet.text %}{% trans 'text' %}{% endif %}
                {% if bet.upload %}{% trans 'image' %}{% endif %}
            </td>
            <td class="result">
                <div class="won" style="{% if not bet.is_won %}display:none;{% endif %}">
                    ✔
                </div>
                <div class="lost" style="{% if not bet.is_lost %}display:none;{% endif %}">
                    ✘
                </div>
                <div class="canceled" style="{% if not bet.is_canceled %}display:none{% endif %}">
                    ☠
                </div>
            </td>
            <td class="flag">
                <div style="{% if not bet.is_flag %}display:none;{% endif %}">
                    ☎
                </div>
            </td>
            {% if request.user.is_authenticated %}
            <td class="correct">
                <div class="correct" style="{% if not bet.can_correct %}display: none;{% endif %}">
                    <a href="{% url bet_status_change bet.pk 'won' %}" title="{% trans 'this bet was won' %}" class="won">✔</a>
                    <a href="{% url bet_status_change bet.pk 'lost' %}" title="{% trans 'this bet was lost' %}" class="lost">✘</a>
                    <a href="{% url bet_status_change bet.pk 'canceled' %}" title="{% trans 'this bet was canceled' %}" class="canceled">☠</a>
                </div>

                <div class="flag" style="{% if not bet.can_flag %}display:none;{% endif %}">
                    <a class="flag" href="{% url bet_status_change bet.pk 'flag' %}" title="{% trans 'this bet result is invalid, it must be corrected by a Referee' %}">☎</a>
                </div>
            </td>
            {% endif %}
        </tr>
        {% endfor %}
    </tbody>
</table>

{% if filter %}
    {% paginate %}
{% endif %}
